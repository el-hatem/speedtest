<!DOCTYPE html>
<html lang="en-US">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- React -->
    <script src="https://unpkg.com/react@16/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@16/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/babel-standalone@6.15.0/babel.min.js"></script>

    <!-- Bootstrap-->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.min.js" integrity="sha384-Atwg2Pkwv9vp0ygtn1JAojH0nYbwNJLPhwyoVbhoPwBhjQPR5VtM2+xf0Uwh9KtT" crossorigin="anonymous"></script>

    <!-- JQuery-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <title>JS Typing Speed Test</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <header class="masthead">
        <h1>Test Your Typing Speed</h1>
    </header>

    <div id="app">
    </div>
</body>

<script type="text/babel">
    class App extends React.Component {
        

        constructor(props) {
            super(props);

            this.timer = [0,0,0,0]
            this.interval = null
            this.state = {
                message: this.randomizeText(this.props.words),
                timerViewer: "00:00:00",
                response: "",
                timerRunning: false
            }
        }
        render() {
            return this.renderTest();
        }

        renderTest() {
            return (
                <main class="main">
                    <div id="intro" >
                        <article class="intro">
                            <p>This is a typing test. Your goal is to duplicate the provided text, EXACTLY, in the field below. The timer starts when you start typing, and only stops when you match this text exactly. Good Luck!</p>
                        </article>
                    </div>
                    <div id="main-section">
                        <section class="test-area">
                            <div id="origin-text">
                                <p id="content">{this.state.message}</p>
                            </div>

                            <div class="test-wrapper">
                                <textarea id="test-area" name="textarea" rows="6" cols="90" value={this.state.response} 
                                onChange={this.handleChange}  onKeyUp={this.handlekey} placeholder="The clock starts when you start typing.">
                                </textarea>
                            </div>

                            <div class="text text-center">
                                <section id="clock">
                                    <div class="timer">{this.state.timerViewer}</div>
                                </section>
                            </div>

                            <div id="control-section" class="flex d-flex justify-content-center">
                                <div class="col-sm-12 col-md-4 mb-2">
                                    <button onClick={this.start} class="btn">Start</button>
                                </div>
                                <div class="col-sm-12 col-md-4 mb-2">
                                    <button onClick={this.stop}  class="btn">Stop</button>
                                </div>
                                <div class="col-sm-12 col-md-4 mb-2">
                                    <button onClick={this.reset} class="btn">Reset</button>
                                </div>
                            </div>
                        </section>
                    </div>
                </main>
            );
        }

        // handle timer
        leadingZero = (time)=>{
            if (time <= 9) {
                time = "0" + time;
            }
            return time;
        }

        // run timer
        runTimer = () =>{
            let currentTime = this.leadingZero(this.timer[0]) + ":" + this.leadingZero(this.timer[1]) + ":" + this.leadingZero(this.timer[2]);

            this.setState({
                timerViewer: currentTime
            });
            this.timer[3]++;

            this.timer[0] = Math.floor((this.timer[3]/100)/60);
            this.timer[1] = Math.floor((this.timer[3]/100) - (this.timer[0] * 60));
            this.timer[2] = Math.floor(this.timer[3] - (this.timer[1] * 100) - (this.timer[0] * 6000));
        }

        randomizeText = (words) => {
            return words[Math.floor(Math.random() * words.length)];
        }

        handleChange = (event) =>{
            this.start();
            this.setState({
                response: event.target.value
            })
        }

        handlekey = (event) => {
            let textEntered = event.target.value;
            let originTextMatch = this.state.message.substring(0,textEntered.length);

            if (textEntered == this.state.message) {
                event.target.parentElement.style.borderColor = "#429890";
                this.setState({
                    response: "",
                    message: this.randomizeText(this.props.words)
                })
            } else {
                if (textEntered == originTextMatch) {
                    event.target.parentElement.style.borderColor = "#65CCf3";
                } else {
                    event.target.parentElement.style.borderColor = "#E95D0F";
                }
            }

            
        }
        start = () => {
            if (!this.state.timerRunning) {
                this.interval = setInterval(this.runTimer, 10);

                this.setState({
                    timerRunning: true
                });
            }
        }

        stop = () => {
            clearInterval(this.interval);
            this.setState({
                    timerRunning: false
            });
        }

        reset = () => {
            // clearInterval(this.interval);
            // this.timer = [0,0,0,0]
            // this.interval = null

            // this.setState({
            //     message: this.randomizeText(this.props.words),
            //     timerViewer: "00:00:00",
            //     response: "",
            //     timerRunning: false
            // });

            location.reload();
             
        }
    } 

    
const getText = async(url) => {

    const response = await fetch(url, {
        credentials: "same-origin",
        cors: {
            enabled: true,
            policy: {
                "allow-credentials": true,
                "allow-origin": `${url}`
            }
          }

    });
    console.log(response);
}

getText('https://filebin.net/skmam1tpircgf04a/file.txt');
</script>
</html>
