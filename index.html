<!DOCTYPE html>
<html lang="en-US">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- React -->
    <script src="https://unpkg.com/react@16/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@16/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/babel-standalone@6.15.0/babel.min.js"></script>

    <!-- Bootstrap-->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.min.js" integrity="sha384-Atwg2Pkwv9vp0ygtn1JAojH0nYbwNJLPhwyoVbhoPwBhjQPR5VtM2+xf0Uwh9KtT" crossorigin="anonymous"></script>

    <!-- JQuery-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <title>JS Typing Speed Test</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <header class="masthead">
        <h1>Test Your Typing Speed</h1>
    </header>

    <div id="app">
    </div>
</body>

<script type="text/babel">
    class App extends React.Component {
        

        constructor(props) {
            super(props);

            this.timer = [0,0,0,0]
            this.interval = null
            this.state = {
                message: this.randomizeText(this.props.words),
                timerViewer: "00:00:00",
                response: "",
                timerRunning: false
            }
        }
        render() {
            return this.renderTest();
        }

        renderTest() {
            return (
                <main class="main">
                    <div id="intro" >
                        <article class="intro">
                            <p>This is a typing test. Your goal is to duplicate the provided text, EXACTLY, in the field below. The timer starts when you start typing, and only stops when you match this text exactly. Good Luck!</p>
                        </article>
                    </div>
                    <div id="main-section">
                        <section class="test-area">
                            <div id="origin-text">
                                <p id="content">{this.state.message}</p>
                            </div>

                            <div class="test-wrapper">
                                <textarea id="test-area" name="textarea" rows="6" cols="90" value={this.state.response} 
                                onChange={this.handleChange}  onKeyUp={this.handlekey} placeholder="The clock starts when you start typing.">
                                </textarea>
                            </div>

                            <div class="text text-center">
                                <section id="clock">
                                    <div class="timer">{this.state.timerViewer}</div>
                                </section>
                            </div>

                            <div id="control-section" class="flex d-flex justify-content-center">
                                <div class="col-sm-12 col-md-4 mb-2">
                                    <button onClick={this.start} class="btn">Start</button>
                                </div>
                                <div class="col-sm-12 col-md-4 mb-2">
                                    <button onClick={this.stop}  class="btn">Stop</button>
                                </div>
                                <div class="col-sm-12 col-md-4 mb-2">
                                    <button onClick={this.reset} class="btn">Reset</button>
                                </div>
                            </div>
                        </section>
                    </div>
                </main>
            );
        }

        // handle timer
        leadingZero = (time)=>{
            if (time <= 9) {
                time = "0" + time;
            }
            return time;
        }

        // run timer
        runTimer = () =>{
            let currentTime = this.leadingZero(this.timer[0]) + ":" + this.leadingZero(this.timer[1]) + ":" + this.leadingZero(this.timer[2]);

            this.setState({
                timerViewer: currentTime
            });
            this.timer[3]++;

            this.timer[0] = Math.floor((this.timer[3]/100)/60);
            this.timer[1] = Math.floor((this.timer[3]/100) - (this.timer[0] * 60));
            this.timer[2] = Math.floor(this.timer[3] - (this.timer[1] * 100) - (this.timer[0] * 6000));
        }

        randomizeText = (words) => {
            return words[Math.floor(Math.random() * words.length)];
        }

        handleChange = (event) =>{
            this.start();
            this.setState({
                response: event.target.value
            })
        }

        handlekey = (event) => {
            let textEntered = event.target.value;
            let originTextMatch = this.state.message.substring(0,textEntered.length);

            if (textEntered == this.state.message) {
                event.target.parentElement.style.borderColor = "#429890";
                this.setState({
                    response: "",
                    message: this.randomizeText(this.props.words)
                })
            } else {
                if (textEntered == originTextMatch) {
                    event.target.parentElement.style.borderColor = "#65CCf3";
                } else {
                    event.target.parentElement.style.borderColor = "#E95D0F";
                }
            }

            
        }
        start = () => {
            if (!this.state.timerRunning) {
                this.interval = setInterval(this.runTimer, 10);

                this.setState({
                    timerRunning: true
                });
            }
        }

        stop = () => {
            clearInterval(this.interval);
            this.setState({
                    timerRunning: false
            });
        }

        reset = () => {
            // clearInterval(this.interval);
            // this.timer = [0,0,0,0]
            // this.interval = null

            // this.setState({
            //     message: this.randomizeText(this.props.words),
            //     timerViewer: "00:00:00",
            //     response: "",
            //     timerRunning: false
            // });

            location.reload();
             
        }
    } 

    
const getText = (s) => {
    return s.split('__end__');
}

var string = `
Jim and Anne will be in charge of the spring field day to be held in early June. They will ask their friends' aid to get set up.__end__The recent emergence of several competitive typing websites has allowed several fast typists on computer keyboards to emerge along with new records, though these are unverifiable for the most part.__end__A transcription service is a business which converts speech (either live or recorded) into a written or electronic text document.__end__Transcription services are often provided for business, legal, or medical purposes. The most common type of transcription is from a spoken-language source into text such as a computer file suitable for printing as a document such as a report.__end__Frank Edward McGurrin, a court stenographer from Salt Lake City, Utah who taught typing classes, reportedly invented touch typing in 1888. On a standard keyboard for English speakers the home row keys are: 'ASDF' for the left hand and 'JKL;' for the right hand.__end__The keyboard is called a QWERTY keyboard because these are the first six letters on the keyboard. Most modern computer keyboards have a raised dot or bar on the home keys for the index fingers to help touch typists maintain and rediscover the correct position on the keyboard quickly with no need to look at the keys.__end__More recently, the ability to touch type on touchscreen phones has been made possible with the use of specialized virtual keyboard software for touch typing.__end__Medical transcription, also known as MT, is an allied health profession dealing with the process of transcribing voice-recorded medical reports that are dictated by physicians, nurses and other healthcare practitioners. Medical reports can be voice files, notes taken during a lecture, or other spoken material.__end__These are dictated over the phone or uploaded digitally via the Internet or through smart phone apps.__end__An ever-growing number of complex and rigid rules plus hard-to-cope-with regulations are now being legislated from state to state. Key federal regulations were formulated by the FDA, FTC, and the CPSC. Each of these federal agencies serves a specific mission. One example: Laws sponsored by the Office of the Fair Debt Collection Practices prevent an agency from purposefully harassing clients in serious debt.__end__The Fair Packaging and Labeling Act makes certain that protection from misleading packaging of goods is guaranteed to each buyer of goods carried in small shops as well as in large supermarkets.__end__Products on the market must reveal the names of all ingredients on the label.__end__Language must be in clear and precise terms that can be understood by everyone. This practice is very crucial for the lives of many people.__end__It is prudent that we recall that the FDA specifically requires that all goods are pure, safe, and wholesome.__end__The FDA states that all goods be produced under highly sanitary conditions.__end__Drugs must be completely safe and must also be effective for their stated purpose. This policy applies to cosmetics that must be both safe and pure. Individuals are often totally unappreciative of the FDA's great dedication.__end__Historically, the fundamental role of pharmacists as a healthcare practitioner was to check and distribute drugs to doctors for medication that had been prescribed to patients. In more modern times, pharmacists advise patients and health care providers on the selection, dosages, interactions, and side effects of medications, and act as a learned intermediary between a prescriber and a patient.__end__Pharmacists monitor the health and progress of patients to ensure the safe and effective use of medication.__end__Pharmacists may practice compounding; however, many medicines are now produced by pharmaceutical companies in a standard dosage and drug delivery form.__end__In some jurisdictions, pharmacists have prescriptive authority to either independently prescribe under their own authority or in collaboration with a primary care physician through an agreed upon protocol.__end__Business casual is an ambiguously defined dress code that has been adopted by many professional and white-collar workplaces in Western countries. It entails neat yet casual attire and is generally more casual than informal attire but more formal than casual or smart casual attire.__end__Casual Fridays preceded widespread acceptance of business casual attire in many offices.__end__A teacher's professional duties may extend beyond formal teaching. Outside of the classroom teachers may accompany students on field trips, supervise study halls, help with the organization of school functions, and serve as supervisors for extracurricular activities. In some education systems, teachers may have responsibility for student discipline.`

var words = getWords(string);
ReactDOM.render(<App words={words} />, document.querySelector('#app'));
</script>
</html>
